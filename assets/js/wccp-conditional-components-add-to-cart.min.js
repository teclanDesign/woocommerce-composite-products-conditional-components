!function(a,b,c,d){function e(b){var c=this;this.init=function(){b.actions.add_action("initialize_composite",function(){c.init_models()},21,this),b.actions.add_action("initialize_composite",function(){c.add_filters()},21,this),b.actions.add_action("initialize_composite",function(){c.init_views()},51,this)},this.init_models=function(){var c=function(c,d){var e=c,f=Backbone.Model.extend({initialize:function(){var a={is_hidden:!1};this.set(a),e.is_component()&&(b.actions.add_action("active_scenarios_changed",this.update_visibility_state,15,this),this.on("change:is_hidden",this.do_action,this))},do_action:function(){b.actions.do_action("step_visibility_changed",[e])},update_visibility_state:function(){var c=b.scenarios.get_active_scenarios(),d=b.scenarios.filter_scenarios_by_type(c,"conditional_components"),f=!1;b.console_log("debug:models",'\nUpdating "'+e.get_title()+'" visibility...'),b.console_log("debug:models",'Active "Hide Components" Scenarios: '+d.toString());var g=b.scenarios.get_scenario_data().scenario_settings.conditional_components;d.length>0&&"undefined"!=typeof g&&a.each(g,function(a,b){_.contains(d,a.toString())&&_.contains(b,e.component_id.toString())&&(f=!0)}),b.console_log("debug:models","\nUpdating 'Step_Visibility_Model': \""+e.get_title()+'", Attribute: "is_hidden": '+f.toString()),b.debug_tab_count=b.debug_tab_count+2,this.set({is_hidden:f}),b.debug_tab_count=b.debug_tab_count-2}}),g=new f(d);return g};a.each(b.get_steps(),function(a,b){b.step_visibility_model=new c(b)})},this.add_filters=function(){b.filters.add_filter("step_is_valid",this.step_is_valid,10,this),b.filters.add_filter("step_is_locked",this.step_is_locked,10,this),b.filters.add_filter("component_is_optional",this.component_is_optional,10,this),b.filters.add_filter("step_validation_messages",this.step_validation_messages,10,this)},this.step_validation_messages=function(a,b,c){return c.is_component()&&c.step_visibility_model.get("is_hidden")&&(a=[]),a},this.step_is_valid=function(a,b){return b.is_component()&&b.step_visibility_model.get("is_hidden")&&(a=!0),a},this.step_is_locked=function(a,b){return b.is_component()&&b.step_visibility_model.get("is_hidden")&&(a=!0),a},this.component_is_optional=function(a,b){return b.step_visibility_model.get("is_hidden")&&(a=!0),a},this.init_views=function(){var c=function(c,d){var e=c,f=Backbone.View.extend({initialize:function(){b.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,10,this),b.actions.add_action("active_step_changed",this.update_pointers,100,this)},step_visibility_changed_handler:function(a){this.update_pointers(),a.step_index===e.step_index&&(this.update_visibility(),this.update_views()),this.update_indexes()},update_indexes:function(){b.console_log("debug:views",'\nRefreshing "'+e.get_title()+'" indexes...');var c=0,d=b.$composite_summary.data("columns"),f="",g=1;c=_.filter(b.get_steps(),function(a){return a.step_visibility_model.get("is_hidden")&&a.step_index<e.step_index?a:void 0}).length,g=e.step_index-c+1,((g-1)%d===0||1===d)&&(f="first"),g%d===0&&(f+=" last"),e.$step_title.find(".step_index").html(g),!1!==b.composite_pagination_view&&b.composite_pagination_view.view_elements[e.step_id].$pagination_element.find(".element_index").html(g),e.is_component()&&(!1!==b.composite_summary_view&&(b.composite_summary_view.view_elements[e.step_id].$summary_element.removeClass("first last").addClass(f),b.composite_summary_view.view_elements[e.step_id].$summary_element.find(".step_index").html(g)),a.each(b.composite_summary_widget_views,function(a,b){b.composite_summary_view.view_elements[e.step_id].$summary_element.find(".step_index").html(g)}))},update_visibility:function(){var c=this;b.console_log("debug:views",'\nRendering "'+e.get_title()+'" visibility...'),!1!==b.composite_pagination_view&&(this.model.get("is_hidden")?b.composite_pagination_view.view_elements[e.step_id].$pagination_element.hide():b.composite_pagination_view.view_elements[e.step_id].$pagination_element.show()),!1!==b.composite_summary_view&&(this.model.get("is_hidden")?b.composite_summary_view.view_elements[e.step_id].$summary_element.hide():b.composite_summary_view.view_elements[e.step_id].$summary_element.show()),a.each(b.composite_summary_widget_views,function(a,d){c.model.get("is_hidden")?b.is_initialized?d.composite_summary_view.view_elements[e.step_id].$summary_element.slideUp(250):d.composite_summary_view.view_elements[e.step_id].$summary_element.hide():b.is_initialized?d.composite_summary_view.view_elements[e.step_id].$summary_element.slideDown(250):d.composite_summary_view.view_elements[e.step_id].$summary_element.show()}),"paged"!==b.settings.layout&&(this.model.get("is_hidden")?e.$el.hide():e.$el.show(),e.is_component()&&e.component_title_view.render_navigation_state())},update_views:function(){!1!==b.composite_pagination_view&&b.composite_pagination_view.render_element_state(e),!1!==b.composite_summary_view&&b.composite_summary_view.render_element_state(e),a.each(b.composite_summary_widget_views,function(a,b){b.composite_summary_view.render_element_state(e)})},update_pointers:function(){if("componentized"===b.settings.layout_variation)return!1;var c=b.get_current_step(),d=b.get_next_step(),f=b.get_previous_step();e.step_index===c.step_index+1&&(e.step_visibility_model.get("is_hidden")?a.each(b.get_steps(),function(a,c){if(a>e.step_index&&(c.is_review()||!1===c.step_visibility_model.get("is_hidden"))){var f=c;return b.console_log("debug:views",'\nChanged next component pointers to "'+c.get_title()+'".'),!1!==d&&(d._is_next=!1,d.$el.removeClass("next")),f._is_next=!0,f.$el.addClass("next"),!1}}):e.step_index!==d.step_index&&(b.console_log("debug:views",'\nReset next component pointers to "'+e.get_title()+'".'),!1!==d&&(d.$el.removeClass("next"),d._is_next=!1),e.$el.addClass("next"),e._is_next=!0)),e.step_index===c.step_index-1&&(e.step_visibility_model.get("is_hidden")?a.each(_.clone(b.get_steps()).reverse(),function(a,c){if(c.step_index<e.step_index&&(c.is_review()||!1===c.step_visibility_model.get("is_hidden"))){var d=c;return b.console_log("debug:views",'\nChanged previous component pointers to "'+c.get_title()+'".'),!1!==f&&(f._is_previous=!1,f.$el.removeClass("prev")),d._is_previous=!0,d.$el.addClass("prev"),!1}}):e.step_index!==f.step_index&&(b.console_log("debug:views",'\nReset previous component pointers to "'+e.get_title()+'".'),!1!==f&&(f.$el.removeClass("prev"),f._is_previous=!1),e.$el.addClass("prev"),e._is_previous=!0))}}),g=new f(d);return g};a.each(b.get_steps(),function(a,b){b.step_visibility_view=new c(b,{el:b.$el,model:b.step_visibility_model})}),b.composite_add_to_cart_button_view.$el_button.on("click",function(){a.each(b.get_components(),function(a,b){b.step_visibility_model.get("is_hidden")&&b.$component_options_select.val("")})})}}var f={};a(".composite_data").on("wc-composite-initializing",function(){var b=a(this).data("container_id");if("undefined"!=typeof f[b])return!0;if("undefined"==typeof wc_cp_composite_scripts[b])return!1;var c=wc_cp_composite_scripts[b];f[b]=new e(c),f[b].init()})}(jQuery,window,document);